<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanti auguri Bubon!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            text-align: center;
            padding: 20px;
            max-width: 400px;
            width: 100%;
        }

        h1 {
            color: white;
            font-size: 2.2em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(255,255,255,0.3); }
            to { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.6); }
        }

        .slot-machine {
            background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            border: 5px solid #ffd700;
        }

        .slots-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 3px solid #333;
            border-radius: 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .slot-content {
            transition: transform 0.1s ease;
        }

        .spinning {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-320px); }
        }

        .spin-button {
            background: linear-gradient(145deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(255,107,107,0.3);
            margin: 10px;
        }

        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(255,107,107,0.4);
        }

        .spin-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .message {
            color: white;
            font-size: 1.2em;
            margin: 20px 0;
            min-height: 30px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .minigame {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .memory-game {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 250px;
            margin: 0 auto;
        }

        .memory-card {
            width: 55px;
            height: 55px;
            background: linear-gradient(145deg, #ffd700, #ffed4e);
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .memory-card:hover {
            transform: scale(1.05);
        }

        .memory-card.flipped {
            background: linear-gradient(145deg, #74b9ff, #0984e3);
            color: white;
        }

        .password-game {
            text-align: center;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5em;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 15px 0;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .hint {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: white;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .simon-game {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 20px auto;
        }

        .simon-button {
            width: 90px;
            height: 90px;
            border: none;
            border-radius: 15px;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .simon-red { background: linear-gradient(145deg, #ff6b6b, #ee5a24); }
        .simon-blue { background: linear-gradient(145deg, #74b9ff, #0984e3); }
        .simon-green { background: linear-gradient(145deg, #55efc4, #00b894); }
        .simon-yellow { background: linear-gradient(145deg, #fdcb6e, #f39c12); }

        .simon-button.active {
            transform: scale(0.95);
            filter: brightness(1.5);
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }

        .puzzle-game {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 180px;
            margin: 20px auto;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .puzzle-tile {
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, #ddd, #bbb);
            border: 1px solid #999;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .puzzle-tile.empty {
            background: transparent;
            border: 1px dashed #666;
        }

        .puzzle-tile:hover:not(.empty) {
            transform: scale(1.1);
        }

        .countdown {
            font-size: 2em;
            color: #ff6b6b;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #55efc4);
            width: 0%;
            transition: width 0.3s ease;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            pointer-events: none;
        }

        .final-reveal {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
            animation: finalGlow 2s ease-in-out infinite alternate;
        }

        @keyframes finalGlow {
            from { box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 20px rgba(255,215,0,0.5); }
            to { box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 40px rgba(255,215,0,0.8); }
        }

        .final-reveal h2 {
            color: #2d3436;
            font-size: 2em;
            margin-bottom: 15px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .hidden {
            display: none;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .quiz-option {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

                .download-btn {
            display: inline-block;
            background: linear-gradient(145deg, #55efc4, #00b894);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0, 184, 148, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0, 184, 148, 0.4);
        }

        .suspense-text {
            font-size: 1.5em;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin: 20px 0;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .slot {
                width: 70px;
                height: 70px;
                font-size: 2em;
            }
            
            .memory-card {
                width: 45px;
                height: 45px;
                font-size: 1em;
            }
            
            .simon-button {
                width: 70px;
                height: 70px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Buon Compleanno!     Bubon ðŸŽðŸŽ</h1>
        
        <div id="slot-phase" class="slot-machine">
            <div class="slots-container">
                <div class="slot">
                    <div class="slot-content" id="slot1">ðŸŽ²</div>
                </div>
                <div class="slot">
                    <div class="slot-content" id="slot2">ðŸŽ²</div>
                </div>
                <div class="slot">
                    <div class="slot-content" id="slot3">ðŸŽ²</div>
                </div>
            </div>
            <button class="spin-button" id="spin-btn" onclick="spin()">GIRA!</button>
            <div class="message" id="slot-message">Premi il pulsante per iniziare a giocare !</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>

        <div id="memory-game" class="minigame hidden">
            <h3 style="color: white; margin-bottom: 15px;">ðŸ§  Sfida della Memoria Estrema</h3>
            <p style="color: white; margin-bottom: 15px; font-size: 0.9em;">Trova tutte le 8 coppie! Hai solo 60 secondi!</p>
            <div class="countdown" id="memory-timer">60</div>
            <div class="memory-game" id="memory-board">
                <!-- Cards will be generated by JS -->
            </div>
            <div class="message" id="memory-message">Clicca le carte per rivelare i simboli!</div>
        </div>

        <div id="password-game" class="minigame hidden">
            <h3 style="color: white; margin-bottom: 15px;">ðŸ” Codice Segreto</h3>
            <p style="color: white; margin-bottom: 15px;">Decifra il codice per sbloccare la prossima sfida!</p>
            <input type="text" class="password-input" id="password-input" placeholder="INSERISCI CODICE" maxlength="20">
            <div class="hint">
                ðŸ’¡ <strong>Indizio:</strong><br>
                Il mio soprannome preferito con cui tu mi chiami<br>
            </div>
            <button class="spin-button" onclick="checkPassword()">VERIFICA</button>
            <div class="message" id="password-message">Usa l'indizio per scoprire il codice...</div>
        </div>

        <div id="simon-game" class="minigame hidden">
            <h3 style="color: white; margin-bottom: 15px;">ðŸŽµ Simon says - Livello Impossibile</h3>
            <p style="color: white; margin-bottom: 15px;">Ripeti la sequenza di 8 colori senza sbagliare!</p>
            <div class="suspense-text" id="simon-level">Livello: 1/8</div>
            <div class="simon-game">
                <button class="simon-button simon-red" onclick="simonClick(0)"></button>
                <button class="simon-button simon-blue" onclick="simonClick(1)"></button>
                <button class="simon-button simon-green" onclick="simonClick(2)"></button>
                <button class="simon-button simon-yellow" onclick="simonClick(3)"></button>
            </div>
            <button class="spin-button" id="simon-start" onclick="startSimon()">INIZIA SEQUENZA</button>
            <div class="message" id="simon-message">Osserva attentamente la sequenza, poi ripetila!</div>
        </div>

        <div id="puzzle-game" class="minigame hidden">
            <h3 style="color: white; margin-bottom: 15px;">ðŸ§© Puzzle Scorrevole</h3>
            <p style="color: white; margin-bottom: 15px;">Ricomponi i numeri in ordine da 1 a 8!</p>
            <div class="countdown" id="puzzle-timer">120</div>
            <div class="puzzle-game" id="puzzle-board">
                <!-- Puzzle tiles will be generated by JS -->
            </div>
            <button class="spin-button" onclick="shufflePuzzle()">MESCOLA</button>
            <div class="message" id="puzzle-message">Clicca i numeri vicini allo spazio vuoto per spostarli!</div>
        </div>

        <div id="final-suspense" class="minigame hidden">
            <h3 style="color: white; margin-bottom: 20px;">ðŸŽ­ Il Momento della VeritÃ </h3>
            <div class="suspense-text">Il destino ti ha portato fin qui...</div>
            <div class="suspense-text" style="animation-delay: 2s;">Hai superato ogni sfida...</div>
            <div class="suspense-text" style="animation-delay: 4s;">Ora scopri cosa ti aspetta...</div>
            <div class="countdown" id="final-countdown">10</div>
            <div class="message" id="final-suspense-message">Preparati alla rivelazione finale...</div>
        </div>

        <div id="final-reveal" class="hidden">
            <div class="final-reveal">
                <h2>ðŸŽ‰ CONGRATULAZIONI! ðŸŽ‰</h2>
                <p class="gift-reveal" style="font-size: 1.2em; color: #2d3436; margin: 20px 0;">Hai superato tutte le prove e hai sbloccato il tuo regalo!</p>
                <a href="regalo.PNG" download="regalo.PNG" class="download-btn">ðŸŽ Scarica la tua Sorpresa! ðŸŽ</a>
                 <p style="color: #636e72; font-size: 0.9em; margin-top: 20px;">
                    Clicca il pulsante per scoprire cosa ti aspetta... ðŸ˜‰
                </p>
            </div>
        </div>
    </div>

    <script>
	
        const symbols = ['ðŸŽ²', 'ðŸ€', 'â­', 'ðŸŽ¯', 'ðŸ”®', 'ðŸ’Ž', 'ðŸŽª', 'ðŸŽ¨', 'ðŸŽ­', 'ðŸŽª'];
        let spinCount = 0;
        let gamePhase = 'slot';
        let challengesCompleted = 0;
        const totalChallenges = 4;
        
        // Memory game variables
        let memoryImages = [];
        let memoryCards = [];
        let flippedCards = [];
        let matches = 0;
        let memoryTimer = 60;
        let memoryInterval;
        
        // Load images from folder
        function loadMemoryImages() {
            const imageNames = ['1.png', '2.png', '3.png', '4.png', '5.png', '6.png', '7.png', '8.png'];
            memoryImages = [...imageNames, ...imageNames]; // Create pairs
        }

        // Simon game variables
        let simonSequence = [];
        let playerSequence = [];
        let simonLevel = 0;
        let simonPlaying = false;
        let simonWatching = false;

        // Puzzle game variables
        let puzzleBoard = [1, 2, 3, 4, 5, 6, 7, 8, 0];
        let puzzleTimer = 120;
        let puzzleInterval;
		
		// ===== POSIZIONE 1: CLASSE REACTIONRECORDER =====
// Inserisci DOPO le variabili esistenti (dopo "let puzzleInterval;")

class ReactionRecorder {
    constructor() {
        this.mediaRecorder = null;
        this.recordedChunks = [];
        this.stream = null;
        this.isRecording = false;
        this.recordingStartTime = null;
    }

    async requestCameraPermission() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    facingMode: 'user'
                }, 
                audio: true 
            });
            
            this.showPermissionSuccess();
            stream.getTracks().forEach(track => track.stop());
            return true;
        } catch (error) {
            console.error('Errore accesso webcam:', error);
            this.showPermissionError();
            return false;
        }
    }

    showPermissionSuccess() {
        const permissionDiv = document.createElement('div');
        permissionDiv.innerHTML = `
            <div style="
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(145deg, #00b894, #55efc4);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.5s ease;
            ">
                OK! possiamo iniziare!
            </div>
        `;
        document.body.appendChild(permissionDiv);
        
        setTimeout(() => {
            permissionDiv.style.animation = 'slideOut 0.5s ease forwards';
            setTimeout(() => permissionDiv.remove(), 500);
        }, 3000);
    }

    showPermissionError() {
        alert('Accetta il permesso per iniziare!');
    }

    async startSecretRecording() {
        try {
            this.stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    facingMode: 'user'
                }, 
                audio: true 
            });

            this.mediaRecorder = new MediaRecorder(this.stream, {
                mimeType: 'video/webm;codecs=vp9'
            });

            this.recordedChunks = [];
            
            this.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    this.recordedChunks.push(event.data);
                }
            };

            this.mediaRecorder.onstop = () => {
                this.createDownloadableVideo();
            };

            this.mediaRecorder.start(100);
            this.isRecording = true;
            this.recordingStartTime = Date.now();
            
            
            return true;
        } catch (error) {
            console.error('Errore avvio registrazione:', error);
            return false;
        }
    }


    stopRecording() {
        if (this.mediaRecorder && this.isRecording) {
            this.mediaRecorder.stop();
            this.isRecording = false;
            
            if (this.stream) {
                this.stream.getTracks().forEach(track => track.stop());
            }
            
            const indicator = document.getElementById('recording-indicator');
            if (indicator) indicator.remove();
            
            console.log('?? Registrazione terminata!');
        }
    }

    createDownloadableVideo() {
    console.log('ðŸŽ¬ Creando video scaricabile...');
    console.log('Chunks disponibili:', this.recordedChunks.length);
    
    if (this.recordedChunks.length === 0) {
        console.error('âŒ Nessun chunk video disponibile!');
        
        // Mostra messaggio di errore all'utente
        const placeholder = document.getElementById('video-download-placeholder');
        if (placeholder) {
            placeholder.innerHTML = `
                <div style="color: #e17055; padding: 15px;">
                    âš ï¸ Errore nella registrazione del video<br>
                    <small>Riprova ricaricando la pagina</small>
                </div>
            `;
        }
        return;
    }
    
    try {
        const blob = new Blob(this.recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        
        // Calcola durata
        const duration = this.recordingStartTime ? 
            Math.round((Date.now() - this.recordingStartTime) / 1000) : 0;
        
        console.log('âœ… Video creato con successo!');
        console.log('ðŸ“Š Dimensione blob:', blob.size, 'bytes');
        console.log('â±ï¸ Durata:', duration, 'secondi');
        
        // Chiama il metodo per aggiungere il download
        this.addVideoDownloadButton(url, duration);
        
    } catch (error) {
        console.error('âŒ Errore creazione video:', error);
        
        // Mostra errore all'utente
        const placeholder = document.getElementById('video-download-placeholder');
        if (placeholder) {
            placeholder.innerHTML = `
                <div style="color: #e17055; padding: 15px;">
                    âš ï¸ Errore nella creazione del video<br>
                    <small>${error.message}</small>
                </div>
            `;
        }
    }
}

    addVideoDownloadButton(videoUrl, duration) {
    // Cerca il placeholder che Ã¨ stato creato da addVideoDownloadSection()
    const placeholder = document.getElementById('video-download-placeholder');
    
    if (placeholder) {
        // Sostituisci il placeholder con il pulsante di download
        placeholder.innerHTML = `
            <a href="${videoUrl}" download="La_mia_reazione_al_regalo_â¤ï¸.webm" style="
                display: inline-block;
                background: linear-gradient(145deg, #e17055, #d63031);
                color: white;
                padding: 15px 25px;
                border-radius: 50px;
                text-decoration: none;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 8px 15px rgba(214, 48, 49, 0.3);
            " onmouseover="this.style.transform='translateY(-3px)'" 
              onmouseout="this.style.transform='translateY(0)'">
                ðŸŽ¬ Scarica la Tua Reazione (${duration}s)! ðŸŽ¬
            </a>
            <p style="color: #636e72; font-size: 0.8em; margin-top: 10px;">
                La tua espressione quando hai visto il regalo! ðŸ˜
            </p>
        `;
        
        console.log('âœ… Pulsante download aggiunto con successo!');
    } else {
        // Fallback: se non trova il placeholder, crea una sezione separata
        console.log('âš ï¸ Placeholder non trovato, creo sezione separata');
        
        const finalReveal = document.querySelector('#gift-photo-reveal');
        if (finalReveal) {
            const videoSection = document.createElement('div');
            videoSection.innerHTML = `
                <div style="
                    background: rgba(255,255,255,0.1);
                    border-radius: 15px;
                    padding: 20px;
                    margin: 20px 0;
                    text-align: center;
                    border: 2px solid #ffd700;
                    backdrop-filter: blur(10px);
                ">
                    <h3 style="color: #2d3436; margin-bottom: 15px;">
                        ðŸ“¹ VIDEO DELLA TUA REAZIONE! ðŸ“¹
                    </h3>
                    <a href="${videoUrl}" download="La_mia_reazione_al_regalo_â¤ï¸.webv" style="
                        display: inline-block;
                        background: linear-gradient(145deg, #e17055, #d63031);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 50px;
                        text-decoration: none;
                        font-weight: bold;
                        transition: all 0.3s ease;
                        box-shadow: 0 8px 15px rgba(214, 48, 49, 0.3);
                    " onmouseover="this.style.transform='translateY(-3px)'" 
                      onmouseout="this.style.transform='translateY(0)'">
                        ðŸŽ¬ Scarica Video (${duration}s)! ðŸŽ¬
                    </a>
                    <p style="color: #636e72; font-size: 0.8em; margin-top: 10px;">
                        ${duration} secondi di pura emozione! ðŸ’•
                    </p>
                </div>
            `;
            finalReveal.appendChild(videoSection);
        }
    }
    
    // Mostra notifica di successo
    this.showSuccessNotification();
}
debugVideoCreation() {
    console.log('ðŸ” Debug Video Creation:');
    console.log('- Recorded chunks:', this.recordedChunks.length);
    console.log('- Recording start time:', this.recordingStartTime);
    console.log('- Is recording:', this.isRecording);
    
    if (this.recordedChunks.length > 0) {
        console.log('âœ… Ci sono chunks registrati');
        
        // Test manuale creazione video
        const blob = new Blob(this.recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const duration = Math.round((Date.now() - this.recordingStartTime) / 1000);
        
        console.log('ðŸ“¹ Video URL creato:', url);
        console.log('â±ï¸ Durata calcolata:', duration + 's');
        
        // Forza la creazione del download
        this.addVideoDownloadButton(url, duration);
    } else {
        console.log('âŒ Nessun chunk registrato!');
    }
}
    showSuccessNotification() {
        const notification = document.createElement('div');
        notification.innerHTML = `
            <div style="
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(145deg, #00b894, #55efc4);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1001;
                text-align: center;
                animation: popIn 0.5s ease;
            ">
                <h3 style="margin: 0 0 10px 0;">?? Missione Compiuta! ??</h3>
                <p style="margin: 0;">La tua reazione ï¿½ stata immortalata!</p>
            </div>
        `;
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes popIn {
                0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'popIn 0.5s ease reverse';
            setTimeout(() => notification.remove(), 500);
        }, 3000);
    }

    showRecordingReveal() {
        const message = document.getElementById('final-suspense-message');
        message.innerHTML = `
            <div style="
                background: rgba(255,0,0,0.1);
                border: 2px dashed #ff6b6b;
                border-radius: 10px;
                padding: 15px;
                margin: 15px 0;
            ">
                ?? <strong>PLOT TWIST!</strong> ??<br>
                Sto registrando la tua reazione!<br>
                <small style="opacity: 0.8;">Spero tu non abbia fatto facce strane! ??</small>
            </div>
        `;
    }
}

// Inizializza il recorder
const reactionRecorder = new ReactionRecorder();
		
		
		
		
        function updateProgress() {
            const progress = (challengesCompleted / totalChallenges) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function spin() {
            const button = document.getElementById('spin-btn');
            const message = document.getElementById('slot-message');
            const slots = ['slot1', 'slot2', 'slot3'];
            
            button.disabled = true;
            spinCount++;

            slots.forEach(slotId => {
                document.getElementById(slotId).classList.add('spinning');
            });

            setTimeout(() => {
                slots.forEach(slotId => {
                    document.getElementById(slotId).classList.remove('spinning');
                });

                if (spinCount < 4) {
                    slots.forEach(slotId => {
                        document.getElementById(slotId).textContent = symbols[Math.floor(Math.random() * symbols.length)];
                    });
                    
                    const messages = [
                        "Niente... sei un pÃ² sfigata ðŸ¤”",
                        "Ancora niente.. continua! ðŸ˜",
                        "Minchia bubon dai un pÃ² di energia... ðŸŒŸ"
                    ];
                    message.textContent = messages[spinCount - 1];
                    button.disabled = false;
                } else if (spinCount === 4) {
                    document.getElementById('slot1').textContent = 'ðŸ’';
                    document.getElementById('slot2').textContent = 'ðŸ’';
                    document.getElementById('slot3').textContent = 'ðŸ””';
                    message.textContent = "Quasi... impegnati di piÃ¹! ðŸ˜…";
                    button.disabled = false;
                } else if (spinCount === 5) {
                    document.getElementById('slot1').textContent = 'ðŸ’‹';
                    document.getElementById('slot2').textContent = 'ðŸ’‹';
                    document.getElementById('slot3').textContent = 'ðŸ’‹';
                    message.textContent = "Bravaa! hai vinto un bacino! ðŸ’‹";
                    button.disabled = false;
                } else if (spinCount === 6) {
                document.getElementById('slot1').textContent = 'ðŸ”®';
                document.getElementById('slot2').textContent = 'ðŸ’°';
                document.getElementById('slot3').textContent = 'ðŸ””';
                message.textContent = "Ancora niente bubon... ðŸ˜…";
                button.disabled = false;
                } else if (spinCount === 7) {
                document.getElementById('slot1').textContent = 'ðŸ’°';
                document.getElementById('slot2').textContent = 'ðŸ’°';
                document.getElementById('slot3').textContent = 'ðŸ’°';
                message.textContent = "Finalmente!! hai vinto un euro";
                button.disabled = false;
                } else if (spinCount === 8) {
                document.getElementById('slot1').textContent = 'ðŸ’‹';
                document.getElementById('slot2').textContent = 'ðŸ’°';
                document.getElementById('slot3').textContent = 'ðŸ’';
                message.textContent = "Bubon ci sei quasii !";
                button.disabled = false;
                } else if (spinCount === 9) {
                document.getElementById('slot1').textContent = 'ðŸ’°';
                document.getElementById('slot2').textContent = 'ðŸ’°';
                document.getElementById('slot3').textContent = 'ðŸ’';
                message.textContent = "Stai diventanto ludopatica";
                button.disabled = false;
                } else if (spinCount === 10) {
                    document.getElementById('slot1').textContent = 'ðŸ”®';
                    document.getElementById('slot2').textContent = 'ðŸ”®';
                    document.getElementById('slot3').textContent = 'ðŸ”®';
                    message.textContent = "JACKPOT!!! ...o quasi!";
                    
                    setTimeout(() => {
                        document.getElementById('slot-phase').classList.add('hidden');
                        document.getElementById('memory-game').classList.remove('hidden');
                        initMemoryGame();
                    }, 3000);
                }
            }, 3000);
        }

        function initMemoryGame() {
            loadMemoryImages();
            memoryCards = shuffleArray([...memoryImages]);
            flippedCards = [];
            matches = 0;
            memoryTimer = 60;
            
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            
            for (let i = 0; i < 16; i++) {
                const card = document.createElement('button');
                card.className = 'memory-card';
                card.style.backgroundImage = 'none';
                card.style.backgroundSize = 'cover';
                card.style.backgroundPosition = 'center';
                card.textContent = '?';
                card.onclick = () => flipCard(i);
                board.appendChild(card);
            }

            memoryInterval = setInterval(() => {
                memoryTimer--;
                document.getElementById('memory-timer').textContent = memoryTimer;
                
                if (memoryTimer <= 0) {
                    clearInterval(memoryInterval);
                    document.getElementById('memory-message').textContent = "Tempo scaduto! Riprova!";
                    setTimeout(() => initMemoryGame(), 2000);
                }
            }, 1000);
        }

        function flipCard(index) {
            const cards = document.querySelectorAll('.memory-card');
            const card = cards[index];
            const message = document.getElementById('memory-message');

            if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                card.textContent = '';
                card.style.backgroundImage = `url('${memoryCards[index]}')`;
                card.classList.add('flipped');
                flippedCards.push({ index, symbol: memoryCards[index] });

                if (flippedCards.length === 2) {
                    setTimeout(() => {
                        if (flippedCards[0].symbol === flippedCards[1].symbol) {
                            matches++;
                            message.textContent = `Brava! Coppie trovate: ${matches}/8 ðŸŽ‰`;
                            
                            if (matches === 8) {
                                clearInterval(memoryInterval);
                                challengesCompleted++;
                                updateProgress();
                                message.textContent = "Memoria incredibile! Prossima sfida in arrivo...";
                                setTimeout(() => {
                                    document.getElementById('memory-game').classList.add('hidden');
                                    document.getElementById('password-game').classList.remove('hidden');
                                }, 2000);
                            }
                        } else {
                            cards[flippedCards[0].index].textContent = '?';
                            cards[flippedCards[0].index].style.backgroundImage = 'none';
                            cards[flippedCards[0].index].classList.remove('flipped');
                            cards[flippedCards[1].index].textContent = '?';
                            cards[flippedCards[1].index].style.backgroundImage = 'none';
                            cards[flippedCards[1].index].classList.remove('flipped');
                            message.textContent = "Non Ã¨ una coppia! Continua a cercare... ðŸ¤”";
                        }
                        flippedCards = [];
                    }, 1200);
                }
            }
        }

        function checkPassword() {
            const input = document.getElementById('password-input');
            const message = document.getElementById('password-message');
            const password = input.value.toUpperCase();
            

            if (password === 'FINFURLI') {
                message.textContent = "ðŸŽ‰ Codice corretto! Intelligente come sempre!";
                challengesCompleted++;
                updateProgress();
                setTimeout(() => {
                    document.getElementById('password-game').classList.add('hidden');
                    document.getElementById('simon-game').classList.remove('hidden');
                }, 2000);
            } else {
                message.textContent = "âŒ Pssword errata! Bubon mi deludi...";
                input.value = '';
                input.style.border = '2px solid #ff6b6b';
                setTimeout(() => {
                    input.style.border = '2px solid #ddd';
                }, 1000);
            }
        }

        function startSimon() {
            simonSequence = [];
            playerSequence = [];
            simonLevel = 0;
            document.getElementById('simon-start').style.display = 'none';
            nextSimonLevel();
        }

        function nextSimonLevel() {
            simonLevel++;
            document.getElementById('simon-level').textContent = `Livello: ${simonLevel}/8`;
            simonSequence.push(Math.floor(Math.random() * 4));
            playerSequence = [];
            playSimonSequence();
        }

        function playSimonSequence() {
            simonWatching = true;
            let i = 0;
            const interval = setInterval(() => {
                if (i >= simonSequence.length) {
                    clearInterval(interval);
                    simonWatching = false;
                    document.getElementById('simon-message').textContent = "Ora ripeti la sequenza!";
                    return;
                }

                const buttons = document.querySelectorAll('.simon-button');
                const button = buttons[simonSequence[i]];
                button.classList.add('active');
                
                setTimeout(() => {
                    button.classList.remove('active');
                }, 400);
                
                i++;
            }, 600);
        }

        function simonClick(color) {
            if (simonWatching) return;
            
            const buttons = document.querySelectorAll('.simon-button');
            buttons[color].classList.add('active');
            setTimeout(() => buttons[color].classList.remove('active'), 200);
            
            playerSequence.push(color);
            
            if (playerSequence[playerSequence.length - 1] !== simonSequence[playerSequence.length - 1]) {
                document.getElementById('simon-message').textContent = "âŒ Sequenza sbagliata! Ricominciamo...";
                setTimeout(() => startSimon(), 2000);
                return;
            }
            
            if (playerSequence.length === simonSequence.length) {
                if (simonLevel === 8) {
                    document.getElementById('simon-message').textContent = "ðŸŽ‰ Sequenza perfetta completata!";
                    challengesCompleted++;
                    updateProgress();
                    setTimeout(() => {
                        document.getElementById('simon-game').classList.add('hidden');
                        document.getElementById('puzzle-game').classList.remove('hidden');
                        initPuzzleGame();
                    }, 2000);
                } else {
                    document.getElementById('simon-message').textContent = "âœ… Corretto! Prossimo livello...";
                    setTimeout(() => nextSimonLevel(), 1500);
                }
            }
        }

        function initPuzzleGame() {
            puzzleTimer = 120;
            shufflePuzzle();
            
            puzzleInterval = setInterval(() => {
                puzzleTimer--;
                document.getElementById('puzzle-timer').textContent = puzzleTimer;
                
                if (puzzleTimer <= 0) {
                    clearInterval(puzzleInterval);
                    document.getElementById('puzzle-message').textContent = "Tempo scaduto! Nuovo puzzle!";
                    setTimeout(() => initPuzzleGame(), 2000);
                }
            }, 1000);
        }

        function shufflePuzzle() {
            // Simple shuffle algorithm
            for (let i = 0; i < 100; i++) {
                const emptyIndex = puzzleBoard.indexOf(0);
                const possibleMoves = [];
                
                if (emptyIndex > 2) possibleMoves.push(emptyIndex - 3);
                if (emptyIndex < 6) possibleMoves.push(emptyIndex + 3);
                if (emptyIndex % 3 !== 0) possibleMoves.push(emptyIndex - 1);
                if (emptyIndex % 3 !== 2) possibleMoves.push(emptyIndex + 1);
                
                if (possibleMoves.length > 0) {
                    const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    [puzzleBoard[emptyIndex], puzzleBoard[randomMove]] = [puzzleBoard[randomMove], puzzleBoard[emptyIndex]];
                }
            }
            renderPuzzle();
        }

        function renderPuzzle() {
            const board = document.getElementById('puzzle-board');
            board.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const tile = document.createElement('div');
                tile.className = puzzleBoard[i] === 0 ? 'puzzle-tile empty' : 'puzzle-tile';
                tile.textContent = puzzleBoard[i] === 0 ? '' : puzzleBoard[i];
                tile.onclick = () => movePuzzleTile(i);
                board.appendChild(tile);
            }
        }

        function movePuzzleTile(index) {
            const emptyIndex = puzzleBoard.indexOf(0);
            const canMove = 
                (Math.abs(index - emptyIndex) === 1 && Math.floor(index / 3) === Math.floor(emptyIndex / 3)) ||
                Math.abs(index - emptyIndex) === 3;
            
            if (canMove) {
                [puzzleBoard[index], puzzleBoard[emptyIndex]] = [puzzleBoard[emptyIndex], puzzleBoard[index]];
                renderPuzzle();
                
                if (isPuzzleSolved()) {
                    clearInterval(puzzleInterval);
                    document.getElementById('puzzle-message').textContent = "ðŸŽ‰ Puzzle risolto! Ultimo passo...";
                    challengesCompleted++;
                    updateProgress();
                    setTimeout(() => {
                        document.getElementById('puzzle-game').classList.add('hidden');
                        document.getElementById('final-suspense').classList.remove('hidden');
                        startFinalCountdown();
                    }, 2000);
                }
            }
        }

        function isPuzzleSolved() {
            for (let i = 0; i < 8; i++) {
                if (puzzleBoard[i] !== i + 1) return false;
            }
            return puzzleBoard[8] === 0;
        }

        function startFinalCountdown() {
    let countdown = 15;
    const countdownElement = document.getElementById('final-countdown');
    const messageElement = document.getElementById('final-suspense-message');
    
    // ðŸŽ¬ INIZIA REGISTRAZIONE SEGRETA
    reactionRecorder.startSecretRecording();
    
    const suspenseMessages = [
        "Stiamo calibrando i flussocanali quantici...",
        "Reticolando gli splines...",
        "Un attimo, sto cercando le chiavi dell'astronave...",
        "Quasi... devo solo ricordarmi la password del Wi-Fi cosmico.",
        "Ok, trovato! Era 'password123'.",
        "Il momento che hai aspettato si avvicina...",
        "Tutti i pezzi del puzzle stanno per unirsi...",
        "La tua ricompensa sta per essere rivelata...",
        "Preparati a vivere un'esperienza incredibile...",
        "Il destino ha un regalo speciale per te..."
    ];
    
    const interval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        // ðŸ“¹ Rivela che sta registrando
        if (countdown === 8) {
            reactionRecorder.showRecordingReveal();
        }
        
        if (countdown <= 10 && countdown > 0) {
            messageElement.textContent = suspenseMessages[10 - countdown] || "Ancora un attimo...";
        }

        if (countdown === 5) {
            messageElement.textContent = "Oh no! Un'interferenza aliena! ...scherzo!";
        }
        
        if (countdown === 0) {
            clearInterval(interval);
            messageElement.textContent = "âœ¨ Ãˆ ARRIVATO IL MOMENTO! âœ¨";
            setTimeout(() => {
                document.getElementById('final-suspense').classList.add('hidden');
                finalSlotSpin();
            }, 2000);
        }
    }, 1000);
}

function finalSlotSpin() {
    document.getElementById('slot-phase').classList.remove('hidden');
    const message = document.getElementById('slot-message');
    const button = document.getElementById('spin-btn');
    
    message.textContent = "ðŸ¥ IL GIRO DELLA VERITÃ€! ðŸ¥";
    button.textContent = "SCOPRI IL REGALO!";
    button.disabled = false;
    button.style.background = "linear-gradient(145deg, #00b894, #55efc4)";
    button.style.fontSize = "1.5em";
    button.style.animation = "pulse 1s ease-in-out infinite";
    
    button.onclick = () => {
        const slots = ['slot1', 'slot2', 'slot3'];
        button.disabled = true;
        message.textContent = "ðŸŒŸ I fili del destino si stanno tessendo... ðŸŒŸ";
        
        slots.forEach(slotId => {
            document.getElementById(slotId).classList.add('spinning');
        });

        // Red herring phase
        setTimeout(() => {
            document.getElementById('slot1').classList.remove('spinning');
            document.getElementById('slot1').textContent = 'ðŸ•';
            message.textContent = "Uhm... una pizza? Non credo sia questo...";
        }, 2000);

        setTimeout(() => {
            document.getElementById('slot2').classList.remove('spinning');
            document.getElementById('slot2').textContent = 'ðŸ§¦';
            message.textContent = "Un calzino? Stiamo scherzando?! Ritentiamo!";
        }, 4000);

        setTimeout(() => {
            document.getElementById('slot3').classList.remove('spinning');
            document.getElementById('slot3').textContent = 'ðŸ¥¦';
            message.textContent = "Broccoli?! No, no, no. Il sistema deve essere impazzito. Reset!";
            
            // Reset and spin again
            setTimeout(() => {
                message.textContent = "Ok, riproviamo sul serio questa volta!";
                slots.forEach(slotId => {
                    document.getElementById(slotId).textContent = 'ðŸŽ';
                    document.getElementById(slotId).classList.add('spinning');
                });
                
                // Real spin
                setTimeout(() => {
                    document.getElementById('slot1').classList.remove('spinning');
                    document.getElementById('slot1').textContent = 'âœˆï¸';
                    message.textContent = "âœˆï¸ Ok, questo Ã¨ piÃ¹ promettente...";
                }, 2000);

                setTimeout(() => {
                    document.getElementById('slot2').classList.remove('spinning');
                    document.getElementById('slot2').textContent = 'ðŸŒž';
                    message.textContent = "ðŸŒž Molto meglio! L'ultimo...";
                }, 4000);

                setTimeout(() => {
                    document.getElementById('slot3').classList.remove('spinning');
                    document.getElementById('slot3').textContent = 'ðŸŒŠ';
                    message.textContent = "ðŸŽŠ JACKPOT LEGGENDARIO! ðŸŽŠ";
                    
                    createMassiveConfetti();
                    
                    // ðŸŽ¬ QUI INIZIA LA RIVELAZIONE CON FOTO INLINE
                    setTimeout(() => {
                        document.getElementById('slot-phase').classList.add('hidden');
                        showGiftRevealWithPhoto(); // ðŸ†• NUOVA FUNZIONE
                    }, 3000);
                }, 6000);
            }, 3000);
        }, 6000);
    };
}

// ===== NUOVA FUNZIONE: Mostra regalo con foto inline =====
function showGiftRevealWithPhoto() {
    // Crea il contenitore per la rivelazione con foto
    const giftContainer = document.createElement('div');
    giftContainer.id = 'gift-photo-reveal';
    giftContainer.innerHTML = `
        <div style="
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
            animation: finalGlow 2s ease-in-out infinite alternate;
            text-align: center;
        ">
            <h2 style="
                color: #2d3436;
                font-size: 2em;
                margin-bottom: 20px;
                animation: bounce 1s ease infinite;
            ">ðŸŽ‰ CONGRATULAZIONI! ðŸŽ‰</h2>
            
            <p style="
                font-size: 1.3em;
                color: #2d3436;
                margin: 20px 0;
                font-weight: bold;
            ">Hai superato tutte le prove!</p>
            
            <!-- ðŸŽ¬ AREA DOVE APPARIRÃ€ LA FOTO -->
            <div id="gift-photo-container" style="
                background: white;
                border-radius: 15px;
                padding: 20px;
                margin: 20px 0;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                min-height: 200px;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
            ">
                <div id="photo-loading" style="
                    font-size: 1.5em;
                    color: #666;
                    animation: pulse 1s ease-in-out infinite;
                ">
                    ðŸŽ Caricamento del tuo regalo... ðŸŽ
                </div>
            </div>
            
            <p style="
                color: #636e72;
                font-size: 1.1em;
                margin: 20px 0;
                font-style: italic;
            ">âœ¨ Il momento che hai aspettato Ã¨ finalmente arrivato! âœ¨</p>
        </div>
    `;
    
    // Aggiungi alla pagina
    document.querySelector('.container').appendChild(giftContainer);
    
    // ðŸŽ¬ Dopo 3 secondi, mostra la foto del regalo
    setTimeout(() => {
        showActualGiftPhoto();
    }, 3000);
}

// ===== FUNZIONE CHE MOSTRA LA FOTO DEL REGALO =====
function showActualGiftPhoto() {
    const photoContainer = document.getElementById('gift-photo-container');
    const loadingDiv = document.getElementById('photo-loading');
    
    // Rimuovi il loading
    loadingDiv.remove();
    
    // Aggiungi la foto del regalo
    photoContainer.innerHTML = `
        <div style="text-align: center; width: 100%;">
            <img 
                src="regalo.PNG" 
                alt="Il tuo regalo speciale!" 
                style="
                    max-width: 100%;
                    max-height: 400px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    animation: photoAppear 1s ease-out;
                "
                onload="this.style.animation='photoAppear 1s ease-out'"
                onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2ZmZiIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8dGV4dCB4PSIxNTAiIHk9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2Ij7wn4+BIEZvdG8gTm9uIFRyb3ZhdGEgPC90ZXh0Pgo8L3N2Zz4K'; this.alt='Foto non trovata - controlla che regalo.PNG sia nella stessa cartella'"
            >
            <div style="
                margin-top: 20px;
                font-size: 1.2em;
                color: #2d3436;
                font-weight: bold;
            ">
                ðŸŽ Ecco il tuo regalo! ðŸŽ
            </div>
        </div>
    `;
    
    // Aggiungi stile per animazione
    const style = document.createElement('style');
    style.textContent = `
        @keyframes photoAppear {
            0% { 
                opacity: 0; 
                transform: scale(0.8) rotateY(90deg); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1) rotateY(0deg); 
            }
        }
    `;
    document.head.appendChild(style);
    
    // ðŸŽ¬ DOPO che la foto Ã¨ apparsa, ferma la registrazione e aggiungi download
    setTimeout(() => {
        // Ferma registrazione dopo aver catturato la reazione alla foto
        reactionRecorder.stopRecording();
        
        // Aggiungi sezione video download SOTTO la foto
        setTimeout(() => {
            addVideoDownloadSection();
        }, 2000);
    }, 10000);
}

// ===== FUNZIONE PER AGGIUNGERE DOWNLOAD VIDEO =====
function addVideoDownloadSection() {
    const giftContainer = document.getElementById('gift-photo-reveal');
    
    const videoSection = document.createElement('div');
    videoSection.innerHTML = `
        <div style="
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid #ffd700;
            backdrop-filter: blur(10px);
        ">
            <h3 style="color: #2d3436; margin-bottom: 15px;">
                ðŸ“¹ BONUS SORPRESA! ðŸ“¹
            </h3>
            <p style="color: #636e72; margin-bottom: 15px;">
                Ho registrato la tua reazione alla rivelazione del regalo! â¤ï¸
            </p>
            <p style="color: #636e72; font-size: 0.9em; margin-bottom: 20px;">
                Un ricordo prezioso da conservare per sempre! ðŸ¥°
            </p>
            <div id="video-download-placeholder" style="
                color: #74b9ff;
                font-style: italic;
                padding: 10px;
            ">
                ðŸŽ¬ Il video sarÃ  pronto tra poco... â³
            </div>
        </div>
    `;
    
    giftContainer.appendChild(videoSection);
}
        function createMassiveConfetti() {
            const colors = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43', '#10ac84', '#ee5a24'];
            
            // Create multiple waves of confetti
            for (let wave = 0; wave < 5; wave++) {
                setTimeout(() => {
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => {
                            const confetti = document.createElement('div');
                            confetti.className = 'confetti';
                            confetti.style.left = Math.random() * window.innerWidth + 'px';
                            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                            confetti.style.width = (Math.random() * 8 + 5) + 'px';
                            confetti.style.height = (Math.random() * 8 + 5) + 'px';
                            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                            
                            const duration = Math.random() * 3 + 2;
                            const rotation = Math.random() * 360;
                            
                            confetti.style.animation = `fall ${duration}s linear forwards, rotate ${duration}s linear forwards`;
                            
                            const style = document.createElement('style');
                            style.textContent = `
                                @keyframes fall {
                                    to {
                                        transform: translateY(${window.innerHeight + 100}px) rotate(${rotation}deg);
                                        opacity: 0;
                                    }
                                }
                                @keyframes rotate {
                                    to {
                                        transform: rotate(${rotation * 2}deg);
                                    }
                                }
                            `;
                            document.head.appendChild(style);
                            
                            document.body.appendChild(confetti);
                            
                            setTimeout(() => {
                                if (confetti.parentNode) confetti.remove();
                                if (style.parentNode) style.remove();
                            }, duration * 1000 + 500);
                        }, i * 50);
                    }
                }, wave * 300);
            }
        }

        function playVictorySound() {
            // Create a simple victory sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.2); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.4); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (e) {
                // Fallback if Web Audio API is not supported
                console.log('Audio not supported');
            }
        }

        // Initialize the game
        updateProgress();
        window.addEventListener('load', async () => {
    // Richiedi permessi webcam subito
    await reactionRecorder.requestCameraPermission();
});
    </script>
</body>
</html>
